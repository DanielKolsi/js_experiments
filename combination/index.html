<!DOCTYPE html>
<html>

<head>
  <title>Combination</title>
  <style>
    html,
    body,
    #ip-map {
      margin: 50;
      padding: 10;
      width: 98%;
      height: 95%;
    }
  </style>
  <!--link rel="stylesheet" type="text/css" href="css/style.css"-->
  <script type="text/javascript" src="src/config.js"></script>
  <script src="https://unpkg.com/react@15.3.0/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@15.3.0/dist/react-dom.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<body>

  <div id="content"></div>
  <div id="test"></div>
  <h3>Google Maps IP mapping</h3>
  <div id="ip-map"></div>
  <script>
    var map;
    var marker;

    function initialize() {
      var mapOptions = {
        zoom: 8,
        center: new google.maps.LatLng(-34.397, 150.644),
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById('ip-map'),
        mapOptions);

        marker = new google.maps.Marker({
          position: new google.maps.LatLng(-34.397, 150.644),
          title:"IP Point"
        });

      marker.setMap(map);
      google.maps.event.addDomListener(window, 'load', initialize);
    }


    function pan(lat, lng) {
      //var panPoint = new google.maps.LatLng(document.getElementById("lat").value, document.getElementById("lng").value);
      var panPoint = new google.maps.LatLng(lat, lng);
      map.panTo(panPoint);
      marker.setPosition(panPoint);
    }
  </script>
    <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyBjmdHr9PZaOoSyLNHd4gJMb1aF2VSJbqU&callback=initialize'
    async defer>
  </script>

  <script type="text/javascript">
    $(document).ready(function() {
      console.log('doc ready');

    });

    getLocationByIP = function(ip) {
      $.ajax({
        type: "GET",
        dataType: "text", // JSON
        url: SERVER_URL + "/ip/" + ip,

        success: function(data) {
          mapIP(data);
          console.log('data=' + data);
        },
        error: function(err) {
          console.log("url_error=" + SERVER_URL);
          console.log("error=" + err);
        }
      });
    };

    function mapIP(data) {
      console.log('mapping, data=' + data);
      var result = JSON.parse(data);

      lat = result.data.latitude;
      lng = result.data.longitude;
      pan(lat, lng)
      /*response.write('<br>IPv4: '+ result.data.ipv4);
      response.write('<br>Hostname: '+ result.data.hostname);
      response.write('<br>Continent code: '+ result.data.continent_code);
      response.write('<br>Continent name: '+ result.data.continent_name);
      response.write('<br>Country ISO code: '+ result.data.country_iso_code);
      response.write('<br>Country name: '+ result.data.country_name);
      response.write('<br>Subdivision 1 ISO code: '+ result.data.subdivision_1_iso_code);
      response.write('<br>Subdivision 1 name: '+ result.data.subdivision_1_name);
      response.write('<br>Subdivision 2 ISO code: '+ result.data.subdivision_2_iso_code);
      response.write('<br>Subdivision 2 name: '+ result.data.subdivision_2_name);
      response.write('<br>City: '+result.data.city_name);
      response.write('<br>Latitude: '+result.data.latitude);
      response.write('<br>Longitude: '+result.data.longitude);
      response.write('<br>Metro code: '+ result.data.metro_code);
      response.write('<br>Time zone: '+ result.data.time_zone);
      response.write('<br>Postal code: '+ result.data.postal_code);

      response.write('<br>Accuracy radius: '+ result.data.accuracy_radius);*/
      latitude = result.data.latitude;
      longitude = result.data.longitude;
      var row1 = "<p>" + '<br>IPv4: ' + result.data.ipv4 + "</p>";
      $(row1).appendTo("#test");
      var row2 = "<p>" + '<br>Hostname: ' + result.data.hostname + "</p>";
      $(row2).appendTo("#test");
      // $.each
      //var tblRow = "<tr  + "<td>"  "</td>" + "</tr>";
      //$(tblRow).appendTo(); // parse JSON from client side & append to table
    }
  </script>
  <script type="text/babel" src="./index.js"></script>
  <label>lat</label><input type="text" id="lat" />
  <br/>
  <label>lng</label><input type="text" id="lng" />
  <input type="button" value="updateCenter" onclick="pan(60, 60)" />
  </body>
</html>

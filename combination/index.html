<!DOCTYPE html>
<html>

<head>
  <title>Combination</title>
  <style>
    html,
    body,
    #ip-map {
      margin: 5;
      padding: 10;
      width: 99%;
      height: 85%;
    }
  </style>
  <!--link rel="stylesheet" type="text/css" href="css/style.css"-->
  <script type="text/javascript" src="src/config.js"></script>
  <script src="https://unpkg.com/react@15.3.0/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@15.3.0/dist/react-dom.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<body>

  <div id="content">

  </div>

  <div data-first="dataTable1">

    <br>
    <table width="100%" id="IPTable1"  border="1">
      <thead>
        <th>Latitude</th>
        <th>Longitude</th>
        <th>City</th>
        <th>Country</th>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div data-second="dataTable2">
    <table width="100%" id="IPTable2"  border="1">
      <thead>
        <th>Hostname</th>
        <th>Time zone</th>
        <th>Postal code</th>
        <th>Country ISO code</th>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div data-third="dataTable3">
    <table width="100%" id="IPTable3"  border="1">
      <thead>
        <th>Continent code</th>
        <th>Continent name</th>
        <th>Metro code</th>
        <th>Accuracy radius</th>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div id="test"></div>
  <br>
  <div id="ip-map"></div>
  <script>
    var map;
    var marker;

    function initialize() {
      var mapOptions = {
        zoom: 8,
        center: new google.maps.LatLng(-34.397, 150.644),
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById('ip-map'),
        mapOptions);

        marker = new google.maps.Marker({
          position: new google.maps.LatLng(-34.397, 150.644),
          title:"IP Point"
        });

      marker.setMap(map);
      google.maps.event.addDomListener(window, 'load', initialize);
    }


    function pan(lat, lng) {
      //var panPoint = new google.maps.LatLng(document.getElementById("lat").value, document.getElementById("lng").value);
      var panPoint = new google.maps.LatLng(lat, lng);
      map.panTo(panPoint);
      marker.setPosition(panPoint);
    }
  </script>
    <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyBjmdHr9PZaOoSyLNHd4gJMb1aF2VSJbqU&callback=initialize'
    async defer>
  </script>

  <script type="text/javascript">
    $(document).ready(function() {

    });

    clearTable =Â function() {
      console.log('removing table xxx');
      $('[data-first]').hide();
      $('[data-second]').hide();
      $('[data-third]').hide();

    }

    getLocationByIP = function(ip) {
      $.ajax({
        type: "GET",
        dataType: "text", // JSON
        url: SERVER_URL + "/ip/" + ip,

        success: function(data) {
          mapIP(data);
        },
        error: function(err) {
          console.log("url_error=" + SERVER_URL);
          console.log("error=" + err);
        }
      });
    };

    function mapIP(data) {

      var result = JSON.parse(data);

      lat = result.data.latitude;
      lng = result.data.longitude;
      pan(lat, lng)

      var row1 = "<tr style=\x22text-align:center\x22>" + "<td>" + lat + "</td>" + "<td>" + lng + "</td>" + "<td>" + result.data.city_name + "</td>" + "<td>" + result.data.country_name + "</td></tr>";
      var row2 = "<tr style=\x22text-align:center\x22>" + "<td>" + result.data.hostname + "</td>" + "<td>" + result.data.time_zone + "</td>" + "<td>" + result.data.postal_code + "</td>" + "<td>" + result.data.country_iso_code + "</td></tr>";
      var row3 = "<tr style=\x22text-align:center\x22>" + "<td>" + result.data.continent_code + "</td>" + "<td>" + result.data.continent_name + "</td>" + "<td>" + result.data.metro_code + "</td>" + "<td>" + result.data.accuracy_radius + "</td></tr>";
      $(row1).appendTo("#dataTable1 tbody");
      $(row2).appendTo("#dataTable2 tbody");
      $(row3).appendTo("#dataTable3 tbody");
    }
  </script>
  <script type="text/babel" src="./index.js"></script>
  <label>lat</label><input type="text" id="lat" />
  <br/>
  <label>lng</label><input type="text" id="lng" />
  <input type="button" value="updateCenter" onclick="pan(60, 60)" />
  </body>
</html>

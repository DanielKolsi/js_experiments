<!DOCTYPE html>
<html>

<head>
  <title>Combination</title>
  <style>
    html,
    body,
    #ip-map {
      margin: 5;
      padding: 10;
      width: 99%;
      height: 85%;
    }
  </style>
  <!--link rel="stylesheet" type="text/css" href="css/style.css"-->
  <script type="text/javascript" src="src/config.js"></script>
  <script src="https://unpkg.com/react@15.3.0/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@15.3.0/dist/react-dom.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<body>
  <script type="text/javascript" async defer>
      JSElement = document.createElement('script');
      JSElement.src = 'https://maps.googleapis.com/maps/api/js?key='+API_KEY+'&callback=initialize';
      document.getElementsByTagName('head')[0].appendChild(JSElement);
  </script>

  <div id="content">
  </div>
  <div id="latLong">
    <label>Latitude: </label><input type="text" id="lat" />
    <br/>
    <label>Longitude: </label><input type="text" id="lng" />
    <input type="button" value="updateCenter" onclick="pan()" />
  </div>

  <div data-first="dataTable1">

    <br>
    <table width="100%" id="IPTable1" border="1">
      <thead>
        <th>Latitude</th>
        <th>Longitude</th>
        <th>City</th>
        <th>Country</th>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div data-second="dataTable2">
    <table width="100%" id="IPTable2" border="1">
      <thead>
        <th>Hostname</th>
        <th>Time zone</th>
        <th>Postal code</th>
        <th>Country ISO code</th>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div data-third="dataTable3">
    <table width="100%" id="IPTable3" border="1">
      <thead>
        <th>Continent code</th>
        <th>Continent name</th>
        <th>Metro code</th>
        <th>Accuracy radius</th>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div id="test"></div>
  <br>
  <div id="ip-map"></div>
  <script>
    var map;
    var marker;

    function initialize() {
      var mapOptions = {
        zoom: 8,
        center: new google.maps.LatLng(40, 40),
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById('ip-map'),
        mapOptions);

        marker = new google.maps.Marker({
          position: new google.maps.LatLng(40, 40),
          title:"IP Point"
        });

      marker.setMap(map);
      google.maps.event.addDomListener(window, 'load', initialize);
    }

    function pan() {
      var point = new google.maps.LatLng(document.getElementById("lat").value, document.getElementById("lng").value);
      map.panTo(point);
      marker.setPosition(point);
    }

    function moveToIP(lat, lng) {
      var point = new google.maps.LatLng(lat, lng);
      map.panTo(point);
      marker.setPosition(point);
    }
  </script>




  <script type="text/javascript">
    $(document).ready(function() {
    });


    getLocationByIP = function(ip) {

      $.ajax({
        type: "GET",
        dataType: "text", // JSON
        url: SERVER_URL + "/ip/" + ip,

        success: function(data) {
          mapIP(data);
        },
        error: function(err) {
          alert('Incorrect IP: ' + SERVER_URL + " error = " + err);
          console.log("url_error=" + SERVER_URL);
          console.log("error=" + err);
        }
      });
    };

    function mapIP(data) {

      var result = JSON.parse(data);

      lat = result.data.latitude;
      lng = result.data.longitude;
      moveToIP(lat, lng);

      var row1 = "<tr style=\x22text-align:center\x22>" + "<td>" + lat + "</td>" + "<td>" + lng + "</td>" + "<td>" + result.data.city_name + "</td>" + "<td>" + result.data.country_name + "</td></tr>";
      var row2 = "<tr style=\x22text-align:center\x22>" + "<td>" + result.data.hostname + "</td>" + "<td>" + result.data.time_zone + "</td>" + "<td>" + result.data.postal_code + "</td>" + "<td>" + result.data.country_iso_code + "</td></tr>";
      var row3 = "<tr style=\x22text-align:center\x22>" + "<td>" + result.data.continent_code + "</td>" + "<td>" + result.data.continent_name + "</td>" + "<td>" + result.data.metro_code + "</td>" + "<td>" + result.data.accuracy_radius + "</td></tr>";
      $(row1).appendTo("#IPTable1 tbody");
      $(row2).appendTo("#IPTable2 tbody");
      $(row3).appendTo("#IPTable3 tbody");
    }
  </script>
  <script type="text/babel" src="./index.js"></script>

  </body>
</html>
